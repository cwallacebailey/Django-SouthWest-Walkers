{% extends 'structure/base.html' %}
{{ post.post_title }}
{% block title  %}
{{ post.post_title }}
{% endblock %}

{% block content %}


<div class="container text-center border-blue">
    <br>
    <div class="row">
        <h1>
            {{ post.post_title }} 
        </h1>
        <p>
            by: {{ post.post_author.profile.display_name }}
        <p>
    </div>
    <div class="">
        <div class="">
            <div class="">
                <div class="image-container-div">
                    {% if "placeholder" in post.header_image.url %}
                        <img class="card-img-top"
                            src="https://res.cloudinary.com/dkzungvzx/image/upload/c_pad,b_auto:predominant,fl_preserve_transparency//v1658827279/mendip_hills_ep6hxc.jpg">
                    
                    {% else %}

                        <!-- Header Image -->
                        {% if post.header_image.url %}
                            <img class="card-img-top journeyImages fade-animation" src=" {{ post.header_image.url }}">
                        {% endif %}

                        <!-- Image 2 -->
                        {% if "placeholder" not in post.image_2.url %}
                            <img class="card-img-top journeyImages fade-animation" src=" {{ post.image_2.url }}">                
                        {% endif %}

                        <!-- Image 3 -->
                        {% if "placeholder" not in post.image_3.url %}
                            <img class="card-img-top journeyImages fade-animation" src=" {{ post.image_3.url }}">                
                        {% endif %}
                    
                    {% endif %}
                    <br>
                </div>
                <a id="previous">&#10094;</a>
                <a id="next">&#10095;</a>
            </div>
            <div>
                <br>
                    {{ post.created_date }} | {{ post.created_date | timesince }} ago
                <hr>
            </div>
            <div>  
                <h3>Journey Stats</h3>
                <br>
                {% if post.first_cairn or post.second_cairn or post.third_cairn %}
                    {% if post.first_cairn %}
                        {{ post.first_cairn }} <i class="fa-solid fa-mountain"></i>

                    {% endif %}
                    {% if post.second_cairn %}
                        | {{ post.second_cairn }}

                    {% endif %}
                    {% if post.third_cairn %} 
                        | {{ post.third_cairn }}

                    {% endif %}
                {% else %}
                    <p>No Cairns Reached - Still Proud.</p>
                {% endif %}
                <br>
                {% if post.distance > 0 %}
                {{ post.distance }}Km Covered 
                {% endif %}
                
                {% if post.meters_climbed > 0 %}
                | {{ post.distance }} Total Ascent
                {% endif %}
                <hr>
            </div>
            <br>

            <div>
                {{ post.body | safe }} 
            </div>

            {% if post.post_author.id == user.id %}

            <a href="{% url 'update_post' post.pk %}" class="btn btn-secondary">Update</a> 
            <a href="{% url 'delete_post' post.pk %}" class="btn btn-secondary">Delete</a>

            {% else %}

            <a href="{% url 'home' %} " class="btn btn-secondary">Home</a>

            {% endif %}

            <br><br>
            
            {% if user.is_authenticated %}

            <form action="{% url 'star_post' post.pk %}" method="POST">
                {% csrf_token %}
                {% if post.starred %}
                    <button type="submit" name="post_id" value="{{ post.id }}"><i class="fas fa-star"></i></button> - {{ post.total_stars }} star
                {% else %}
                    <button type="submit" name="post_id" value="{{ post.id }}"><i class="far fa-star"></i></button> - {{ post.total_stars }} star
                {% endif %}
            </form>

            <hr>
            <br>
            
            <h2>Comments:</h2>

            <br>

            {% for comment in comments %}
            {% if comment.response == None %}
            <blockquote>
                {{ comment.comment_author }} : {{ comment.created_date | timesince }} ago
                <br>
                <p>{{ comment.body | safe }}</p>
                <br>
            </blockquote>
            
            {% for response in comment.responses %}

                <blockquote>
                    {{ response.comment_author }} : {{ response.created_date | timesince }} ago
                    <br>
                    {{ response.body | safe }}
                    <br>
                </blockquote>
            
            {% endfor %}

                <form method="post">
                    {{ comment_form }}
                    {% csrf_token %}
                    <br>
                    <input type="hidden" name="parent_id" value="{{ comment.id }}">
                    <button type="submit" class="btn btn-secondary" name="response" value="response">Post Response</button>
                </form>

            {% endif %}
            {% endfor %}

            <hr>
            <h4>Leave a comment:</h4>
                <form method="post">
                    {{ comment_form }}
                    {% csrf_token %}
                    <br>
                    <button type="submit" class="btn btn-secondary" name="comment" value="comment">Post Comment</button>
                </form>
            <hr>
            <br>

            {% else %}

                <button class="star-icon" type="submit", name="post_id", value="{{ post.id }}"><i class="far fa-star"></i></button> - {{ post.total_stars }} Stars

            {% endif %}
        </div>
    </div>          
</div>

{% endblock %}